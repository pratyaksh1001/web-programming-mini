<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Home</title>
        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    </head>
    <body class="bg-black w-screen text-white">
        <div id="navbar" class="w-full bg-blue-600 p-2 rounded-b-md flex">
            <a href="home.html" class="text-2xl w-fit">Keep It Up</a>
            <div class="ml-auto w-fit flex gap-4">
                <span id="welcome-user" class="text-lg"></span>
                <a href="tasklist.html" class="w-fit text-2xl">Task List</a>
                <button id="logout-button" class="w-fit text-lg bg-red-600 px-3 py-1 rounded">Logout</button>
            </div>
        </div>
        <div id="add-section" class="mt-32 bg-blue-600 w-1/2 ml-auto mr-auto">
            <p class="w-fit ml-auto mr-auto text-xl">Enter the task details</p>
            <input
                type="text"
                id="title"
                placeholder="   Enter the Task Title"
                class="w-fit bg-gray-50 text-black h-12"
            />
            <textarea
                placeholder="enter the content"
                class="bg-gray-50 text-black mt-10"
                id="content"
            ></textarea>
            <br />
            <label for="deadline">enter deadline</label>
            <input type="date" id="deadline" name="deadline" />
            <button class="" id="add-button">Add task</button>
        </div>
    </body>
    <script>
        const currentUser = JSON.parse(localStorage.getItem("currentUser"));
        if (!currentUser) {
            window.location.href = "login.html";
        }

        document.getElementById("welcome-user").textContent = `Welcome, ${currentUser.username}!`;

        document.getElementById("logout-button").addEventListener("click", () => {
            localStorage.removeItem("currentUser");
            window.location.href = "login.html";
        });

        var addButton = document.getElementById("add-button");

        var users = JSON.parse(localStorage.getItem("users")) || [];
        var currentUserIndex = users.findIndex(u => u.username === currentUser.username);
        
        if (currentUserIndex === -1) {
            window.location.href = "login.html";
        }

        var tasks = users[currentUserIndex].tasks || [];

        class Task {
            constructor(title, content, date, deadline) {
                this.title = title;
                this.content = content;
                this.date = date;
                this.done = false;
                this.deadline = deadline;
            }
        }

        addButton.addEventListener("click", () => {
            var title = document.getElementById("title").value;
            var content = document.getElementById("content").value;
            var deadline = document.getElementById("deadline").value;
            
            var newTask = new Task(
                title,
                content,
                new Date().getFullYear(),
                deadline,
            );
            
            tasks.push(newTask);
            users[currentUserIndex].tasks = tasks;
            localStorage.setItem("users", JSON.stringify(users));
            
            document.getElementById("title").value = "";
            document.getElementById("content").value = "";
            document.getElementById("deadline").value = "";
        });
    </script>
</html>
